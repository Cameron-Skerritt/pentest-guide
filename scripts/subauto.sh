#! /bin/bash

#if [ "$EUID" -ne 0 ]
#  then echo "Please run as root"
#  exit
#fi


if [[ $# -eq 0 ]] ; then
    echo "[-] Domain not supplied [-]"
    echo "[+] Example: >_ $0 domain.com [+]"
    exit 1
fi

if [[ $# > 1 ]] ; then
	echo "[-] Unnecessary Arguments [-]"
    echo "[+] Example: >_ $0 domain.com [+]"
	exit 1
fi


regex='^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$'
if ! [[ $1 =~ $regex ]]; then
	echo "[-] Argument is not a domain. [-]"
    echo "[+] Example: >_ $0 domain.com [+]"
	exit 1
fi


echo "[+]------ Starting Subdomain Enumeration ------[+]";
echo "[+]------ Zishan Ahamed Thandar ------[+]";

echo "[+] Running Subfinder [+]"
subfinder -silent -d $1 -all -o $11.txt  >/dev/null 2>&1

echo "[+] Running Assetfinder [+]"
assetfinder $1 >$12.txt

echo "[+] Running Amass Active Brute [+]"
amass enum -active -brute -min-for-recursive 2 -max-dns-queries 500 -d $1 -o $13.txt -r 8.8.8.8,1.1.1.1,8.8.4.4,1.0.0.1 >/dev/null 2>&1

#echo "[*] Running chaos [+]" # Need API Thats why removed
#chaos -d $1 -o $15.txt

echo "[+] Combining results [+]"
cat $11.txt $12.txt $13.txt >> $1all.txt

echo "[+] Removing Duplicates [+]"
sort -u $1all.txt > $1domains.txt
awk '!seen[$0]++' $1domains.txt > $1all.txt
sort $1all.txt | uniq > $1domains.txt

#echo "[+] Checking for alive domains.. [+]" 
#httpx -l $1domains.txt -silent > $1activehttpsubs.txt 

echo "[*] Running httprobe [+]"
cat $1domains.txt | httprobe > $1httpsubsl1.txt
# Removing http if https is there
awk '!seen[$0]++{sub(/^https?:\/\//, "", $0); sites[$0]++} END{for (site in sites) if(sites[site] == 1) print "http://"site; else print "https://"site}' $1httpsubsl1.txt | sort -u > $1httpsubs2.txt

echo "[+] Sorting active target domains.. [+]"
cat $1httpsubs2.txt | grep $1 > $1httpsubs.txt

echo "[+] Removing https or http from domains [+]"
cat $1httpsubs.txt |sed -E 's/^\s*.*:\/\///g' >> $1subs.txt

echo "[+] Creating and saving ip list [+]"
cat "$1subs.txt" | while read domain; do dig +timeout=4 +short "$domain"; done | sort -u > "$1ips.txt"

echo "[+] Removing Unnecessary Files [+]"
rm $11.txt $12.txt $13.txt $1all.txt $1domains.txt $1httpsubsl1.txt $1httpsubs2.txt

echo "[+] Automated Subdomain Takeover Test [+]"
subzy r --hide_fails --targets $1subs.txt >> $1Takeover.txt

echo "[+] Check $1Takeover.txt [+]"
echo "[+] Check Manually Also Subdomain Takeover with https://github.com/EdOverflow/can-i-take-over-xyz [+]"

echo "[-] Done [-]"

